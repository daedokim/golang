<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>WebSocket</title>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
</head>

<body>
    <p id="output"></p>

    <p>
        <button class="addRoom" type="button">룸추가</button> <br />
        <button class="dataPush" type="button">룸정보 가져오기</button> <br />
        <button class="playerJoin" type="button">플레이어 조인하기</button> <br />
        <button class="playerExit" type="button">플레이어 일어나기</button> <br />

    </p>
    <script>
        var loc = window.location;
        var uri = 'ws:';

        if (loc.protocol === 'https:') {
            uri = 'wss:';
        }
        uri += '//' + loc.host;
        uri += loc.pathname + 'ws';
        

       
        var uniqueID = GetID();

        ws = new WebSocket(uri)

        console.log(uri);

        ws.onopen = function () {
            console.log('Connected')

            login();                       
        }        

        ws.onmessage = function (evt) {
            var out = document.getElementById('output');
            out.innerHTML += evt.data + '<br>';
        }

        ws.onclose = function() {
            console.log("close");
        }

        function login() {
            var packetData = {};
            packetData.packetNum = 1;
            packetData.data = {"userId":uniqueID, "osType":1, "guestMode":true};
            var jsonStr = JSON.stringify(packetData);
            ws.send(jsonStr); 
        }


        $(function () {
            $(document).ready(function() {

            });
            
            $('.dataPush').click(function () {

                var packetData = {};
                packetData.packetNum = 2;
                packetData.data = { "roomIndex": 1};
                var jsonStr = JSON.stringify(packetData);
                ws.send(jsonStr);
            });

            $('.playerJoin').click(function () {

                var packetData = {};
                packetData.packetNum = 3;
                packetData.data = {"roomIndex": 1, "userIndex":1, "chairIndex":1, "buyInLeft":100000};
                var jsonStr = JSON.stringify(packetData);
                ws.send(jsonStr);
            });
            
            $('.addRoom').click(function () {

                var packetData = {};
                packetData.packetNum = 4;
                packetData.data = {"buyInMin":1000, "buyInMax":100000};
                var jsonStr = JSON.stringify(packetData);
                ws.send(jsonStr);
                });
            $('.playerExit').click(function () {

                var packetData = {};
                packetData.packetNum = 5;
                packetData.data = {"roomIndex": 1, "userIndex":1};
                var jsonStr = JSON.stringify(packetData);
                ws.send(jsonStr);
            });

            
        });

        function GetID() {
            //return '_' + Math.random().toString(36).substr(2, 9);
            return "_" + GetUserAgent() + "11";
        }

        function GetUserAgent() {
            var agt = navigator.userAgent.toLowerCase();
            if (agt.indexOf("chrome") != -1) return 'Chrome'; 
            if (agt.indexOf("opera") != -1) return 'Opera'; 
            if (agt.indexOf("staroffice") != -1) return 'Star Office'; 
            if (agt.indexOf("webtv") != -1) return 'WebTV'; 
            if (agt.indexOf("beonex") != -1) return 'Beonex'; 
            if (agt.indexOf("chimera") != -1) return 'Chimera'; 
            if (agt.indexOf("netpositive") != -1) return 'NetPositive'; 
            if (agt.indexOf("phoenix") != -1) return 'Phoenix'; 
            if (agt.indexOf("firefox") != -1) return 'Firefox'; 
            if (agt.indexOf("safari") != -1) return 'Safari'; 
            if (agt.indexOf("skipstone") != -1) return 'SkipStone'; 
            if (agt.indexOf("msie") != -1) return 'Internet Explorer'; 
            if (agt.indexOf("netscape") != -1) return 'Netscape'; 
            if (agt.indexOf("mozilla/5.0") != -1) return 'Mozilla'; 
        }
    </script>

</body>


</html>